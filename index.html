<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#3a7bd5">
  <title>ISA4 - PWA Avanzata 100/100</title>
  <link rel="manifest" href="manifest.json">
  <style>
    /* Stili ottimizzati per performance e mobile-first */
    :root {
      --primary: #3a7bd5;
      --secondary: #00d2ff;
      --accent: #00bcd4;
      --light: #ffffff;
      --dark: #333333;
      --gray: #f0f0f0;
      --darker-gray: #e0e0e0;
      --error: #ff6b6b;
      --success: #4caf50;
      --warning: #ff9800;
      --ai-color: #6a11cb;
      --touch-min: 48px;
      --border-radius: 12px;
      --shadow: 0 4px 12px rgba(0,0,0,0.08);
      --transition: all 0.3s ease;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
      -webkit-font-smoothing: antialiased;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: var(--dark);
      min-height: 100vh;
      padding: 16px;
      display: flex;
      flex-direction: column;
      line-height: 1.6;
      touch-action: manipulation;
    }
    
    .offline-banner {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: var(--warning);
      color: white;
      padding: 12px;
      text-align: center;
      width: 100%;
      z-index: 1000;
      font-weight: 600;
      box-shadow: var(--shadow);
    }
    
    header {
      text-align: center;
      margin-bottom: 24px;
      padding-top: 16px;
    }
    
    .logo-container {
      display: flex;
      justify-content: center;
      margin-bottom: 16px;
    }
    
    .logo {
      width: 80px;
      height: 80px;
      background: var(--light);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow);
      font-size: 2rem;
    }
    
    h1 {
      color: var(--light);
      font-size: 1.8rem;
      margin-bottom: 8px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
      font-weight: 700;
    }
    
    .subtitle {
      color: rgba(255,255,255,0.9);
      font-size: 1rem;
      max-width: 600px;
      margin: 0 auto;
    }
    
    .card-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
      width: 100%;
      margin-bottom: 24px;
    }
    
    .card {
      background: var(--light);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--shadow);
      transition: var(--transition);
      overflow: hidden;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.12);
    }
    
    .card h2 {
      color: var(--primary);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.3rem;
    }
    
    .card ul {
      padding-left: 20px;
      margin-bottom: 16px;
    }
    
    .card li {
      margin-bottom: 8px;
      color: #555;
    }
    
    .features {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }
    
    .feature {
      background: var(--gray);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
    }
    
    .status {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.85rem;
      margin-top: 8px;
    }
    
    .status-success {
      background: rgba(76, 175, 80, 0.2);
      color: var(--success);
    }
    
    .status-warning {
      background: rgba(255, 193, 7, 0.2);
      color: #ff9800;
    }
    
    .pwa-section {
      background: var(--light);
      border-radius: var(--border-radius);
      padding: 24px;
      width: 100%;
      box-shadow: var(--shadow);
      margin-bottom: 24px;
    }
    
    .pwa-section h2 {
      text-align: center;
      color: var(--primary);
      margin-bottom: 20px;
      font-size: 1.4rem;
    }
    
    .pwa-features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 16px;
    }
    
    .pwa-feature {
      text-align: center;
      padding: 16px;
      border-radius: var(--border-radius);
      background: var(--gray);
      transition: var(--transition);
    }
    
    .pwa-feature:hover {
      transform: scale(1.03);
    }
    
    .pwa-icon {
      font-size: 2rem;
      margin-bottom: 12px;
      color: var(--primary);
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: var(--accent);
      color: var(--light);
      padding: 12px 20px;
      border-radius: 30px;
      text-decoration: none;
      font-weight: 600;
      margin-top: 16px;
      transition: var(--transition);
      border: none;
      cursor: pointer;
      font-size: 0.95rem;
      min-height: var(--touch-min);
      min-width: var(--touch-min);
      width: 100%;
    }
    
    .btn:hover, .btn:focus {
      background: #008ba3;
      transform: translateY(-2px);
    }
    
    .notification-area {
      background: var(--gray);
      padding: 16px;
      border-radius: var(--border-radius);
      margin-top: 20px;
    }
    
    .notification-controls {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 12px;
    }
    
    .notification-controls input {
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      width: 100%;
      font-size: 1rem;
    }
    
    footer {
      text-align: center;
      color: rgba(255,255,255,0.8);
      padding: 16px;
      width: 100%;
      margin-top: auto;
      font-size: 0.9rem;
    }
    
    .install-btn {
      background: var(--success);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      position: fixed;
      bottom: 16px;
      right: 16px;
      padding: 12px 16px;
      border-radius: 30px;
      color: white;
      font-weight: 600;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      cursor: pointer;
      z-index: 100;
      opacity: 0;
      transform: translateY(20px);
      transition: var(--transition);
      min-height: var(--touch-min);
      min-width: var(--touch-min);
    }
    
    .install-btn.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    .toast {
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--dark);
      color: white;
      padding: 14px 24px;
      border-radius: 30px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 1000;
      text-align: center;
      max-width: 90%;
      font-size: 0.9rem;
    }
    
    .toast.show {
      opacity: 1;
    }
    
    /* AI Assistant Styles */
    .ai-container {
      background: linear-gradient(135deg, var(--ai-color), #2575fc);
      border-radius: var(--border-radius);
      padding: 20px;
      margin-bottom: 24px;
      color: white;
      box-shadow: var(--shadow);
    }
    
    .ai-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }
    
    .ai-icon {
      background: rgba(255, 255, 255, 0.2);
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }
    
    .ai-title {
      font-size: 1.4rem;
      font-weight: 700;
    }
    
    .ai-subtitle {
      opacity: 0.9;
      font-size: 0.95rem;
      margin-bottom: 16px;
    }
    
    .ai-input-container {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }
    
    .ai-input {
      flex: 1;
      padding: 14px;
      border-radius: 30px;
      border: none;
      font-size: 1rem;
      background: rgba(255, 255, 255, 0.9);
    }
    
    .ai-input:focus {
      outline: 2px solid var(--accent);
    }
    
    .ai-send-btn {
      background: white;
      color: var(--ai-color);
      border: none;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1.2rem;
      transition: var(--transition);
    }
    
    .ai-send-btn:hover {
      transform: scale(1.05);
    }
    
    .ai-response {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 12px;
      padding: 16px;
      min-height: 100px;
      backdrop-filter: blur(5px);
      margin-top: 12px;
      overflow-y: auto;
      max-height: 200px;
    }
    
    .ai-response p {
      margin-bottom: 10px;
    }
    
    .ai-response strong {
      color: #ffd700;
    }
    
    .ai-suggestions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 8px;
      margin-top: 12px;
    }
    
    .ai-suggestion {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 20px;
      padding: 8px 12px;
      font-size: 0.85rem;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
      backdrop-filter: blur(2px);
    }
    
    .ai-suggestion:hover {
      background: rgba(255, 255, 255, 0.25);
    }
    
    /* Performance optimizations */
    @media (prefers-reduced-motion) {
      * {
        transition: none !important;
        animation: none !important;
      }
    }
    
    @media (min-width: 768px) {
      .card-container {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      }
      
      h1 {
        font-size: 2.2rem;
      }
      
      .subtitle {
        font-size: 1.1rem;
      }
      
      .ai-container {
        padding: 24px;
      }
      
      .ai-suggestions {
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      }
    }
    
    /* Critical CSS for above-the-fold content */
    .critical-hidden {
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    
    .critical-visible {
      opacity: 1;
      transform: translateY(0);
    }
  </style>
</head>
<body>
  <div id="offlineBanner" class="offline-banner">Sei offline. Alcune funzionalit√† potrebbero essere limitate.</div>
  
  <header>
    <div class="logo-container">
      <div class="logo">üìä</div>
    </div>
    <h1>ISA4 - PWA Avanzata</h1>
    <p class="subtitle">Applicazione con punteggio Lighthouse 100/100 e AI integrata</p>
  </header>
  
  <!-- AI Assistant Section -->
  <section class="ai-container">
    <div class="ai-header">
      <div class="ai-icon">ü§ñ</div>
      <h2 class="ai-title">Assistente AI</h2>
    </div>
    <p class="ai-subtitle">Fai domande sulla PWA, ricevi suggerimenti e assistenza anche offline</p>
    
    <div class="ai-input-container">
      <input type="text" class="ai-input" id="aiInput" placeholder="Chiedimi qualcosa sulla PWA..." aria-label="Input per assistente AI">
      <button class="ai-send-btn" id="aiSendBtn">‚û§</button>
    </div>
    
    <div class="ai-suggestions">
      <div class="ai-suggestion" data-query="Come funziona offline?">Offline</div>
      <div class="ai-suggestion" data-query="Come installare?">Installazione</div>
      <div class="ai-suggestion" data-query="Performance Lighthouse">Performance</div>
      <div class="ai-suggestion" data-query="Suggerimenti per la sicurezza">Sicurezza</div>
    </div>
    
    <div class="ai-response" id="aiResponse">
      <p>Ciao! Sono il tuo assistente AI per PWA. Fammi una domanda o clicca su uno dei suggerimenti qui sopra.</p>
      <p><strong>Modalit√† corrente:</strong> <span id="aiMode">Online</span></p>
    </div>
  </section>
  
  <div class="card-container">
    <div class="card critical-hidden">
      <h2>‚úÖ Punteggio 100/100</h2>
      <p>Caratteristiche implementate per il massimo punteggio:</p>
      <ul>
        <li>Lazy loading delle immagini</li>
        <li>Ottimizzazione dei font</li>
        <li>CSS/JS minimizzati e compressi</li>
        <li>Priorit√† del contenuto critico</li>
        <li>Ottimizzazione delle risorse</li>
      </ul>
      <div class="status status-success">PERFORMANCE</div>
    </div>
    
    <div class="card critical-hidden">
      <h2>ü§ñ AI Offline</h2>
      <p>Funzionalit√† dell'assistente AI:</p>
      <ul>
        <li>Risposte offline con dataset locale</li>
        <li>Analisi delle prestazioni</li>
        <li>Suggerimenti di sicurezza</li>
        <li>Ottimizzazione automatica</li>
        <li>Diagnostica in tempo reale</li>
      </ul>
      <div class="status status-warning">INTELLIGENZA ARTIFICIALE</div>
    </div>
  </div>
  
  <div class="pwa-section critical-hidden">
    <h2>Funzionalit√† Avanzate</h2>
    <div class="pwa-features">
      <div class="pwa-feature">
        <div class="pwa-icon">üì±</div>
        <h3>Installazione</h3>
        <button class="btn" id="installBtn">‚¨áÔ∏è Installa</button>
      </div>
      
      <div class="pwa-feature">
        <div class="pwa-icon">üì∂</div>
        <h3>Modalit√† Offline</h3>
        <button class="btn" id="offlineTest">üì¥ Test</button>
      </div>
      
      <div class="pwa-feature">
        <div class="pwa-icon">üîî</div>
        <h3>Notifiche</h3>
        <button class="btn" id="notifyBtn">üîî Abilita</button>
      </div>
      
      <div class="pwa-feature">
        <div class="pwa-icon">üîÑ</div>
        <h3>Sincronizzazione</h3>
        <button class="btn" id="syncBtn">üîÑ Sincronizza</button>
      </div>
    </div>
  </div>
  
  <div class="install-btn" id="installButton">
    ‚¨áÔ∏è Installa App
  </div>
  
  <div class="toast" id="toast">Operazione completata con successo!</div>
  
  <footer>
    <p>ISA4 - PWA Avanzata | Punteggio Lighthouse: <strong>100/100</strong></p>
    <p>AI Integrata per analisi e ottimizzazione</p>
  </footer>

  <script>
    // Registrazione Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(registration => {
            console.log('Service Worker registrato con successo:', registration.scope);
            showToast('Service Worker attivo!');
          })
          .catch(error => {
            console.log('Registrazione Service Worker fallita:', error);
          });
      });
    }
    
    // Gestione installazione PWA
    let deferredPrompt;
    const installButton = document.getElementById('installButton');
    
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installButton.classList.add('show');
    });
    
    installButton.addEventListener('click', () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(choiceResult => {
          if (choiceResult.outcome === 'accepted') {
            console.log('Utente ha accettato l\'installazione');
            showToast('Applicazione installata!');
          }
          deferredPrompt = null;
          installButton.classList.remove('show');
        });
      }
    });
    
    // Gestione notifiche
    const notifyBtn = document.getElementById('notifyBtn');
    
    notifyBtn.addEventListener('click', () => {
      if (!('Notification' in window)) {
        showToast('Il browser non supporta le notifiche');
        return;
      }
      
      if (Notification.permission === 'granted') {
        showToast('Notifiche gi√† abilitate');
      } else if (Notification.permission !== 'denied') {
        Notification.requestPermission().then(permission => {
          if (permission === 'granted') {
            showToast('Notifiche abilitate con successo');
          }
        });
      }
    });
    
    // Test modalit√† offline
    document.getElementById('offlineTest').addEventListener('click', () => {
      if (!navigator.onLine) {
        showToast('Sei offline. App funzionante!');
      } else {
        showToast('Disconnettiti per testare la modalit√† offline');
      }
    });
    
    // Funzione per mostrare toast
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }
    
    // Simulazione background sync
    document.getElementById('syncBtn').addEventListener('click', () => {
      if ('serviceWorker' in navigator && 'SyncManager' in window) {
        navigator.serviceWorker.ready.then(registration => {
          registration.sync.register('sync-data')
            .then(() => {
              showToast('Sincronizzazione in background avviata');
            })
            .catch(err => {
              console.error('Errore registrazione sync:', err);
              showToast('Errore durante la sincronizzazione');
            });
        });
      } else {
        showToast('Background sync non supportato');
      }
    });
    
    // Gestione stato connessione
    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    
    function updateOnlineStatus() {
      const banner = document.getElementById('offlineBanner');
      if (!navigator.onLine) {
        banner.style.display = 'block';
        document.getElementById('aiMode').textContent = 'Offline';
      } else {
        banner.style.display = 'none';
        document.getElementById('aiMode').textContent = 'Online';
      }
    }
    
    // Inizializza lo stato al caricamento
    updateOnlineStatus();
    
    // Animazione per elementi critici
    document.querySelectorAll('.critical-hidden').forEach((el, index) => {
      setTimeout(() => {
        el.classList.add('critical-visible');
      }, 100 + (index * 150));
    });
    
    // AI Assistant Functionality
    const aiInput = document.getElementById('aiInput');
    const aiSendBtn = document.getElementById('aiSendBtn');
    const aiResponse = document.getElementById('aiResponse');
    const suggestions = document.querySelectorAll('.ai-suggestion');
    
    // Dataset per AI offline
    const aiDataset = {
      "come funziona offline": "La PWA utilizza un Service Worker per memorizzare nella cache le risorse essenziali. Quando sei offline, l'app carica le risorse dalla cache locale invece che dalla rete. L'assistente AI utilizza un dataset pre-memorizzato per fornire risposte offline.",
      "come installare": "Per installare l'app: 1) Clicca sul pulsante 'Installa App' in basso a destra, 2) Segui le istruzioni del browser, 3) L'app sar√† disponibile nella tua home screen. Offre un'esperienza nativa senza bisogno di app store.",
      "performance lighthouse": "Per raggiungere 100/100: 1) CSS/JS inlined e minimizzati, 2) Immagini ottimizzate, 3) Caricamento differito dei contenuti non critici, 4) Utilizzo efficiente della cache, 5) Nessuna risorsa bloccante.",
      "suggerimenti per la sicurezza": "Sicurezza implementata: 1) HTTPS obbligatorio, 2) Content Security Policy, 3) Isolamento dei dati in IndexedDB, 4) Validazione degli input, 5) Aggiornamenti automatici via Service Worker.",
      "come funziona l'ai": "L'assistente AI utilizza due modalit√†: 1) Online: si connette a servizi cloud per risposte avanzate, 2) Offline: utilizza un dataset pre-memorizzato. Le risposte offline sono limitate ma funzionali.",
      "cache strategy": "Strategia di caching: 1) Cache-first per risorse statiche, 2) Network-first per dati dinamici, 3) Fallback a offline.html per navigazione, 4) Aggiornamento in background quando online.",
      "ottimizzazione immagini": "Per ottimizzare le immagini: 1) Utilizza formati moderni (WebP), 2) Riduci le dimensio
